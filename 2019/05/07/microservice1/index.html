<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
    <title>Time Lapse</title>
    <link rel="shortcut icon" href="http://lioder.xyz/css/favicon.ico">
    <link href='http://fonts.font.im/css?family=Abel' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="/css/index.css">
    <link rel="stylesheet"
          href="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.13.1/build/styles/tomorrow.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
</head>
<body>
<header>
    <div class="header-container">
        <div class="logo">
            <span class=title>Time Lapse</span>
        </div>
        <ul class="right-list">
            
                <li class="list-item">
                    
                        <a href="/" class="item-link">Home</a>
                    
                </li>
            
                <li class="list-item">
                    
                        <a href="/about" class="item-link">About</a>
                    
                </li>
            
        </ul>
        <div class="icon-wrapper">
            <i data-feather="menu" class="menu-icon"></i>
        </div>
        <div class="mobile-menu" style="visibility: hidden">
            <ul>
                <li class="mobile-menu-item"><a href="/">Home</a></li>
                <li class="mobile-menu-item"><a href="/about">About</a></li>
            </ul>
        </div>
    </div>
</header>

<div class="page">
    <div class="page-container">
        <article class="page-content">
            <h3 class="page-title">微服务从0开始(0)</h3>
            <div class="page-date">Published on 2019-05-07</div>
            <div class="page-tag">
                
                
                <div class="tag">
    <div class="tag-container" style="background-color: #6fa3ef"># Microservice</div>
</div>
                
                
            </div>
            <section class="markdown-content"><h2 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h2><p>因为第二学期软件设计与体系结构课上一直在强调微服务，最后也设计了一个微服务的体系结构，但自己对微服务其实还是一知半解（别笑）。秉持的实践出真知的原则，我还是打算写一个微服务来全面理解一下。</p>
<p>下面列举了我在没有实践微服务之前主要的疑惑：</p>
<ol>
<li>RPC是什么，为什么服务之间不使用Rest和HTTP通信？</li>
<li>服务注册和服务发现是什么？</li>
<li>为什么要用NGINX？</li>
<li>Docker在微服务中有什么用？</li>
<li>CI和CD在微服务中怎样实践？</li>
</ol>
<h2 id="正题"><a href="#正题" class="headerlink" title="正题"></a>正题</h2><blockquote>
<p>我学习微服务主要是用Go语言</p>
</blockquote>
<p>首先解答问题1：RPC是什么，为什么服务之间不使用Rest和HTTP通信？</p>
<p><strong>如果使用Rest和HTTP，那么服务间传递数据是这样的：</strong></p>
<p>服务A将数据encode成json字符串，通过ajax发送给服务B，服务B parse成对象</p>
<p><strong>如果使用gRPC，那么服务间传递数据是这样的：</strong></p>
<p>使用protobuf协议约定数据格式，服务A将数据转化为二进制数据流，基于HTTP 2.0 的二进制数据帧发送给服务B，服务B按照约定的格式parse成对象</p>
<p>微服务可以使用Rest和HTTP通信，但是多了encode和decode的步骤</p>
<h3 id="最基本的微服务结构"><a href="#最基本的微服务结构" class="headerlink" title="最基本的微服务结构"></a>最基本的微服务结构</h3><ul>
<li>先使用protobuf语法定义一个微服务以及他的方法，定义一系列消息对象</li>
<li>然后通过protobuf编译器编译成go语言文件，文件中包含了定义的消息结构体，一系列微服务方法以及接口</li>
<li>写一个service，实现上述接口</li>
<li>创建一个gRPC服务器，将我们的service与协议中的微服务绑定</li>
<li>写一个client，首先拨号连接到gRPC服务器，然后调用协议中的方法创建客户端，客户端可以调用协议中定义的微服务的各种方法</li>
</ul>
<p><img src="https://github.com/lioder/lioder.github.io/raw/master/images/microservice1.png" alt=""></p>
<p>从客户端出发来看，客户端先获取gRPC服务器的连接，然后通过.pb.go获得服务的调用器，之后就像调用本地方法一样使用</p>
<p>而service这边，创建了一个gRPC服务器，并将自己进行注册</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p>这里只做一个梳理和记录，具体的实践代码可以参考：<a href="https://wuyin.io/2018/05/10/microservices-part-1-introduction-and-consignment-service/#more" target="_blank" rel="noopener">Golang 微服务教程（一）</a></p>
</section>
        </article>
    </div>
</div>
</div>
<footer style="position: absolute; left: 0; right: 0; bottom: 0; z-index: 200;">
    <div class="footer-container" style="width: 100%; text-align: center; color: #6e6f6d; height: 50px; line-height: 50px; font-family: 'Abel', sans-serif">
        lioder © 2018 Time Lapse
    </div>
</footer>
<script>
    function async (u, c) {
        var d = document, t = 'script',
            o = d.createElement(t),
            s = d.getElementsByTagName(t)[0];
        o.src = u;
        if (c) {
            o.addEventListener('load', function (e) {
                c(null, e);
            }, false);
        }
        s.parentNode.insertBefore(o, s);
    }
</script>
<script>
    var hasLine = 'false';
    async("//cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.13.1/build/highlight.min.js", function () {
        $('figure pre').each(function (i, block) {
            var figure = $(this).parents('figure');
            if (hasLine === 'false') {
                figure.find('.gutter').hide();
            }
            var lang = figure.attr('class').split(' ')[1] || 'code';
            var codeHtml = $(this).html();
            var codeTag = document.createElement('code');
            codeTag.className = lang;
            codeTag.innerHTML = codeHtml;
            $(this).attr('class', '').empty().html(codeTag);
            figure.attr('data-lang', lang.toUpperCase());
            hljs.highlightBlock(block);
        });
    })
</script>
<script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
<script>
    let menuIcon = 'menu';
    feather.replace();

    document.querySelector('.logo').addEventListener('click', () => {
        location.href = '/';
        // document.querySelector('.menu-icon').style.display = 'none';
    })
    document.querySelector('.icon-wrapper').addEventListener('click', function () {
        let iconEle = document.querySelector('.menu-icon');
        if (menuIcon === 'x') {
            iconEle.dataset.feather = 'menu';
            menuIcon = 'menu';
            document.querySelector('.mobile-menu').style.visibility = 'hidden';
        } else {
            iconEle.dataset.feather = 'x';
            menuIcon = 'x';
            document.querySelector('.mobile-menu').style.visibility = 'visible';
        }
        console.log(menuIcon)
        feather.replace();
    })


</script>
</body>
</html>
